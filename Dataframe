import pandas as pd #Esto es para dataframe
import numpy as np #Esto es para cuando no tiene dato la empresa es decir cuando pone -- porque se scrapea asi
import re #Para limipiar texto
import matplotlib.pyplot as plt #Para hacer graficos

# Lee el csv
df = pd.read_csv("t2.csv")

# Esto es para convertir en un "numero" el market cap ya que se bugea pandas y no los coge bien

def parse_market_cap(val):
    if pd.isna(val):
        return np.nan #Si esta vacio devuelve NaN

    #Convertimos el valor a string y .strip() es para quitar espacios.
    s = str(val).strip()

    #Si el valor esta vacio lo ignora
    if s in ["--", "", "nan"]:
        return np.nan

    #Esta parte es solo para quitar caracteres que no hacen falta porque el scrapper coge todo en la pagina y algunos datos salen con letras al lado.
    s = re.sub(r"[^\d.,BMK]", "", s)

    mult = 1
    if s.endswith("B"):
        mult = 1e9
        s = s[:-1]
    elif s.endswith("M"):
        mult = 1e6
        s = s[:-1]
    elif s.endswith("K"):
        mult = 1e3
        s = s[:-1]

    s = s.replace(",", "")

    try:
        return float(s) * mult
    except:
        return np.nan

df["MarketCap_num"] = df["Market Cap"].apply(parse_market_cap)

print(df[["Market Cap", "MarketCap_num"]].head())  # DEBUG para comprobar

# Gr√°fico de barras (mejor que histograma para empresas)
plt.figure(figsize=(12,6))
plt.bar(range(len(df)), df["MarketCap_num"])
plt.xticks(range(len(df)), df["EPS (Previsto)"], rotation=90)
plt.title("Market Cap por empresa")
plt.tight_layout()

plt.show()



